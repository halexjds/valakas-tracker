<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Status Valakas</title>
  <style>
  body {
    font-family: 'Segoe UI', Arial, sans-serif;
    text-align: center;
    background: url('valakas.png') no-repeat center center fixed;
    background-size: cover;
    color: #eee;
    margin: 0; padding: 30px;
  }
  h1 {
    color: #ff4d4d;
    text-shadow: 0 0 15px #ff0000aa;
    background: rgba(0,0,0,0.5);
    display: inline-block;
    padding: 10px 20px;
    border-radius: 12px;
  }
  #timer, label, footer, input, button {
    background: rgba(0,0,0,0.5);
    border-radius: 10px;
  }
  input, button {
    padding: 10px;
    margin: 10px;
    border: none;
    font-size: 1em;
    color: #fff;
  }
  button {
    background: #ff4d4d;
    cursor: pointer;
    transition: 0.2s;
  }
  button:hover {
    background: #ff6666;
  }
  #muteBtn {
    background: #333;
    color: #eee;
    margin-left: 10px;
  }
  #muteBtn.muted {
    background: #555;
    color: #ffcc00;
  }
  #timer {
    font-size: 2em;
    margin-top: 30px;
    padding: 15px;
  }
  .alert {
    color: #ffcc00;
    font-weight: bold;
  }
  footer {
    margin-top: 60px;
    font-size: 0.9em;
    color: #ccc;
    background: rgba(0,0,0,0.4);
    display: inline-block;
    padding: 5px 15px;
    border-radius: 10px;
  }
</style>

  <script type="module">
    // Import Firebase SDKs (compatíveis com 2025)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";

    const firebaseConfig = {
  apiKey: "AIzaSyCRh9VfLtflFK69QaAyxWrS9opktAn7Vo8",
  authDomain: "valakas-tracker.firebaseapp.com",
  projectId: "valakas-tracker",
  storageBucket: "valakas-tracker.firebasestorage.app",
  messagingSenderId: "1073176685323",
  appId: "1:1073176685323:web:621c3fb91d03053cad900e"
};

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const bossDoc = doc(db, "bosses", "valakas");

    const minRespawn = 11 * 24 * 60 * 60 * 1000;
    const maxRespawn = 17 * 24 * 60 * 60 * 1000;

    async function registerDeath() {
      const snap = await getDoc(bossDoc);
      const now = new Date();

      if (snap.exists()) {
        const nextSpawn = snap.data().nextSpawn.toDate();
        if (now < nextSpawn) {
          alert("⚠️ Já há um registro ativo! Próximo spawn ainda não ocorreu.");
          return;
        }
      }

      const respawnTime = minRespawn + Math.random() * (maxRespawn - minRespawn);
      const nextSpawn = new Date(now.getTime() + respawnTime);

      await setDoc(bossDoc, {
        lastDeath: now,
        nextSpawn: nextSpawn,
        reporter: "Usuário manual"
      });

      alert("✅ Morte registrada! Novo spawn entre 11 e 17 dias.");
      updateTimer();
    }

    async function updateTimer() {
      const snap = await getDoc(bossDoc);
      if (snap.exists()) {
        const nextSpawn = snap.data().nextSpawn.toDate();
        const interval = setInterval(() => {
          const now = new Date();
          const diff = nextSpawn - now;

          if (diff <= 0) {
            document.getElementById("timer").textContent = "🔥 Valakas pode estar vivo!";
            clearInterval(interval);
          } else {
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
            const mins = Math.floor((diff / (1000 * 60)) % 60);
            document.getElementById("timer").textContent = 
              `${days}d ${hours}h ${mins}m até possível respawn`;
          }
        }, 60000); // atualiza a cada 1 min
      } else {
        document.getElementById("timer").textContent = "Nenhum registro ainda.";
      }
    }

    window.onload = updateTimer;
    window.registerDeath = registerDeath;
  </script>
</head>
<body>
  <h1>🔥 Status Valakas</h1>
  <div id="timer" class="timer">Carregando...</div>
  <button onclick="registerDeath()">Registrar morte</button>
</body>
</html>
