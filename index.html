<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Status Valakas</title>
  <style>
    body {
      background: url('valakas.png') no-repeat center center fixed;
      background-size: cover;
      font-family: Arial, sans-serif;
      color: #fff;
      text-align: center;
      padding-top: 50px;
    }
    h1 {
      font-size: 2.5em;
      text-shadow: 2px 2px 6px #000;
    }
    .timer { 
      font-size: 2em; 
      margin: 20px; 
    }
    button { 
      padding: 10px 20px; 
      font-size: 16px; 
      cursor: pointer; 
      margin: 10px; 
      border-radius: 8px;
      border: none;
      background: #b30000;
      color: #fff;
      transition: 0.3s;
    }
    button:hover {
      background: #ff3333;
      transform: scale(1.05);
    }
    .status { 
      margin-top: 20px; 
      font-size: 14px; 
      color: #ffb84d; 
    }
    ul {
      list-style: none;
      padding: 0;
      margin: 10px auto;
      width: fit-content;
      text-align: left;
    }
    li {
      margin: 5px 0;
      font-size: 15px;
      text-shadow: 1px 1px 3px #000;
    }
  </style>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";

    // ================================
    // CONFIGURA√á√ÉO FIREBASE
    // ================================
    const firebaseConfig = {
      apiKey: "AIzaSyCRh9VfLtflFK69QaAyxWrS9opktAn7Vo8",
      authDomain: "valakas-tracker.firebaseapp.com",
      projectId: "valakas-tracker",
      storageBucket: "valakas-tracker.firebasestorage.app",
      messagingSenderId: "1073176685323",
      appId: "1:1073176685323:web:621c3fb91d03053cad900e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const bossDoc = doc(db, "bosses", "valakas");

    // ================================
    // CONFIGURA√á√ïES DO RESPAWN
    // ================================
    const antiSpamMode = 0; // 1 = ativo, 0 = desativado
    const minRespawn = 11 * 24 * 60 * 60 * 1000;
    const maxRespawn = 17 * 24 * 60 * 60 * 1000;

    // ================================
    // REGISTRAR MORTE
    // ================================
    async function registerDeath() {
      const snap = await getDoc(bossDoc);
      const now = new Date();

      if (antiSpamMode === 1 && snap.exists()) {
        const nextSpawn = snap.data().nextSpawn.toDate();
        if (now < nextSpawn) {
          alert("‚ö†Ô∏è Anti-spam ativo: j√° h√° um registro v√°lido at√© o pr√≥ximo spawn.");
          return;
        }
      }

      const respawnTime = minRespawn + Math.random() * (maxRespawn - minRespawn);
      const nextSpawn = new Date(now.getTime() + respawnTime);

      await setDoc(bossDoc, {
        lastDeath: now,
        nextSpawn: nextSpawn,
        reporter: "Usu√°rio manual",
        antiSpamActive: antiSpamMode
      });

      alert("‚úÖ Morte registrada! Novo spawn entre 11 e 17 dias.");
      updateTimer();
    }

    // ================================
    // ATUALIZAR CONTAGEM E FUSOS
    // ================================
    async function updateTimer() {
      const snap = await getDoc(bossDoc);
      const timerEl = document.getElementById("timer");
      const fusoEl = document.getElementById("fusoAtual");
      const listaFusosEl = document.getElementById("listaFusos");

      if (!snap.exists()) {
        timerEl.textContent = "Nenhum registro ainda.";
        return;
      }

      const nextSpawn = snap.data().nextSpawn.toDate();

      // Atualiza contador principal
      const interval = setInterval(() => {
        const now = new Date();
        const diff = nextSpawn - now;

        if (diff <= 0) {
          timerEl.textContent = "üî• Valakas pode estar vivo!";
          clearInterval(interval);
        } else {
          const { days, hours, mins, secs } = timeDiff(diff);
          timerEl.textContent = `${days}d ${hours}h ${mins}m ${secs}s at√© poss√≠vel respawn`;
        }

        // Atualiza fusos com contagem regressiva din√¢mica
        const fusos = [
          "America/Sao_Paulo",
          "America/New_York",
          "Europe/London",
          "Europe/Paris",
          "Europe/Moscow",
          "Asia/Seoul",
          "Asia/Tokyo",
          "Asia/Shanghai",
          "Australia/Sydney"
        ];

        listaFusosEl.innerHTML = fusos.map(f => {
          const fusoDate = new Date(nextSpawn.toLocaleString("en-US", { timeZone: f }));
          const fusoDiff = fusoDate - new Date();
          const { days, hours, mins, secs } = timeDiff(fusoDiff);
          return `<li>üêâ ${f.replace("_", " ")} ‚Üí ${days}d ${hours}h ${mins}m ${secs}s restantes (${formatDate(nextSpawn, f)})</li>`;
        }).join("");

      }, 1000);

      // Fuso local
      const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
      fusoEl.textContent = `üïì Fuso hor√°rio local: ${timezone}`;

      document.getElementById("status").textContent =
        `Anti-spam: ${antiSpamMode === 1 ? "üü¢ Ativado" : "üî¥ Desativado"}`;
    }

    // ================================
    // FUN√á√ïES AUXILIARES
    // ================================
    function timeDiff(diff) {
      return {
        days: Math.floor(diff / (1000 * 60 * 60 * 24)),
        hours: Math.floor((diff / (1000 * 60 * 60)) % 24),
        mins: Math.floor((diff / (1000 * 60)) % 60),
        secs: Math.floor((diff / 1000) % 60)
      };
    }

    function formatDate(date, tz) {
      return new Intl.DateTimeFormat("pt-BR", {
        timeZone: tz,
        dateStyle: "short",
        timeStyle: "medium"
      }).format(date);
    }

    window.onload = updateTimer;
    window.registerDeath = registerDeath;
  </script>
</head>
<body>
  <h1>üéÆüî• Status Valakas üî•üéÆ</h1>
  <div id="timer" class="timer">Carregando...</div>
  <button onclick="registerDeath()">Registrar morte</button>
  <div id="status" class="status">Anti-spam: carregando...</div>

  <h3 id="fusoAtual"></h3>
  <h3>‚è∞ Hor√°rios equivalentes de spawn:</h3>
  <ul id="listaFusos"></ul>
</body>
</html>
