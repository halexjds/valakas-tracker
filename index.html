<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Status Valakas</title>
  <style>
    body {
      background: url('valakas.png') no-repeat center center fixed;
      background-size: cover;
      font-family: Arial, sans-serif;
      color: #fff;
      text-align: center;
      padding-top: 50px;
    }
    .timer { font-size: 2em; margin: 20px; }
    button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
  </style>
  <script type="module">
    // Import Firebase SDKs (compatíveis com 2025)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "SUA_API_KEY",
      authDomain: "SEU_PROJETO.firebaseapp.com",
      projectId: "SEU_PROJETO",
      storageBucket: "SEU_PROJETO.appspot.com",
      messagingSenderId: "SEU_ID",
      appId: "SUA_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const bossDoc = doc(db, "bosses", "valakas");

    const minRespawn = 11 * 24 * 60 * 60 * 1000;
    const maxRespawn = 17 * 24 * 60 * 60 * 1000;

    async function registerDeath() {
      const snap = await getDoc(bossDoc);
      const now = new Date();

      if (snap.exists()) {
        const nextSpawn = snap.data().nextSpawn.toDate();
        if (now < nextSpawn) {
          alert("⚠️ Já há um registro ativo! Próximo spawn ainda não ocorreu.");
          return;
        }
      }

      const respawnTime = minRespawn + Math.random() * (maxRespawn - minRespawn);
      const nextSpawn = new Date(now.getTime() + respawnTime);

      await setDoc(bossDoc, {
        lastDeath: now,
        nextSpawn: nextSpawn,
        reporter: "Usuário manual"
      });

      alert("✅ Morte registrada! Novo spawn entre 11 e 17 dias.");
      updateTimer();
    }

    async function updateTimer() {
      const snap = await getDoc(bossDoc);
      if (snap.exists()) {
        const nextSpawn = snap.data().nextSpawn.toDate();
        const interval = setInterval(() => {
          const now = new Date();
          const diff = nextSpawn - now;

          if (diff <= 0) {
            document.getElementById("timer").textContent = "🔥 Valakas pode estar vivo!";
            clearInterval(interval);
          } else {
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
            const mins = Math.floor((diff / (1000 * 60)) % 60);
            document.getElementById("timer").textContent = 
              `${days}d ${hours}h ${mins}m até possível respawn`;
          }
        }, 60000); // atualiza a cada 1 min
      } else {
        document.getElementById("timer").textContent = "Nenhum registro ainda.";
      }
    }

    window.onload = updateTimer;
    window.registerDeath = registerDeath;
  </script>
</head>
<body>
  <h1>🔥 Status Valakas</h1>
  <div id="timer" class="timer">Carregando...</div>
  <button onclick="registerDeath()">Registrar morte</button>
</body>
</html>
