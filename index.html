<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">
<link rel="icon" href="icon.png" type="image/png">
<title>Valakas Tracker</title>
<style>
  body {
    font-family: 'Segoe UI', Arial, sans-serif;
    text-align: center;
    background: url('valakas.jpg') no-repeat center center fixed;
    background-size: cover;
    color: #eee;
    margin: 0; padding: 30px;
  }
  h1 {
    color: #ff4d4d;
    text-shadow: 0 0 15px #ff0000aa;
    background: rgba(0,0,0,0.5);
    display: inline-block;
    padding: 10px 20px;
    border-radius: 12px;
  }
  #timer, label, footer, input, button {
    background: rgba(0,0,0,0.5);
    border-radius: 10px;
  }
  input, button {
    padding: 10px;
    margin: 10px;
    border: none;
    font-size: 1em;
    color: #fff;
  }
  button {
    background: #ff4d4d;
    cursor: pointer;
    transition: 0.2s;
  }
  button:hover {
    background: #ff6666;
  }
  #muteBtn {
    background: #333;
    color: #eee;
    margin-left: 10px;
  }
  #muteBtn.muted {
    background: #555;
    color: #ffcc00;
  }
  #timer {
    font-size: 2em;
    margin-top: 30px;
    padding: 15px;
  }
  .alert {
    color: #ffcc00;
    font-weight: bold;
  }
  footer {
    margin-top: 60px;
    font-size: 0.9em;
    color: #ccc;
    background: rgba(0,0,0,0.4);
    display: inline-block;
    padding: 5px 15px;
    border-radius: 10px;
  }
</style>
</head>
<body>
  <h1>üî• Valakas Respawn Tracker üî•</h1>

  <label>Hora da morte do Valakas:</label><br>
  <input type="datetime-local" id="deathTime">
  <button onclick="startTimer()">Iniciar Contagem</button>
  <button onclick="resetTimer()">Limpar</button>
  <button id="muteBtn" onclick="toggleMute()">üîä Som Ligado</button> <!-- NOVO -->

  <div id="timer"></div>
  <audio id="alarmSound" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg"></audio>

  <footer>
    Feito por EverusGmr ‚öîÔ∏è | Funciona offline | <a href="#" id="shareLink" style="color:#ff4d4d;">Compartilhar link</a>
  </footer>

<script>
let interval;
const alarm = document.getElementById("alarmSound");
const muteBtn = document.getElementById("muteBtn");

// === Carregar prefer√™ncias ===
window.onload = function() {
  const saved = localStorage.getItem("valakasDeathTime");
  const muted = localStorage.getItem("valakasMuted") === "true";

  if (muted) setMuted(true);

  if (saved) {
    document.getElementById("deathTime").value = saved;
    startTimer();
  }
};

// === Fun√ß√£o de iniciar o timer ===
function startTimer() {
  clearInterval(interval);
  const deathInput = document.getElementById("deathTime").value;
  if (!deathInput) return alert("Insira o hor√°rio da morte do Valakas!");

  localStorage.setItem("valakasDeathTime", deathInput);

  const deathTime = new Date(deathInput);
  const spawnMin = new Date(deathTime.getTime() + 11 * 60 * 60 * 1000);
  const spawnMax = new Date(deathTime.getTime() + 17 * 60 * 60 * 1000);

  interval = setInterval(() => {
    const now = new Date();
    const diff = spawnMin - now;

    if (diff <= 0) {
      document.getElementById("timer").innerHTML =
        `üêâ <b>Valakas pode nascer a qualquer momento!</b><br><span class="alert">Janela at√© ${spawnMax.toLocaleTimeString()}</span>`;
      
      if (!alarm.muted && alarm.paused) alarm.play();
      return;
    }

    const hours = Math.floor(diff / (1000 * 60 * 60));
    const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    const secs = Math.floor((diff % (1000 * 60)) / 1000);

    document.getElementById("timer").innerHTML =
      `‚è≥ Pr√≥ximo spawn em: ${hours}h ${mins}m ${secs}s<br>` +
      `(Janela: ${spawnMin.toLocaleTimeString()} ‚Äî ${spawnMax.toLocaleTimeString()})`;

    if (diff < 15 * 60 * 1000 && !alarm.muted && alarm.paused) alarm.play();
  }, 1000);
}

// === Fun√ß√£o de limpar ===
function resetTimer() {
  clearInterval(interval);
  localStorage.removeItem("valakasDeathTime");
  document.getElementById("timer").innerHTML = "";
  document.getElementById("deathTime").value = "";
  alarm.pause();
  alarm.currentTime = 0;
}

// === Fun√ß√µes de som ===
function toggleMute() {
  const muted = !alarm.muted;
  setMuted(muted);
  localStorage.setItem("valakasMuted", muted);
}

function setMuted(muted) {
  alarm.muted = muted;
  if (muted) {
    muteBtn.textContent = "üîá Som Desligado";
    muteBtn.classList.add("muted");
  } else {
    muteBtn.textContent = "üîä Som Ligado";
    muteBtn.classList.remove("muted");
  }
}

// === Compartilhar link ===
document.getElementById("shareLink").onclick = function(e) {
  e.preventDefault();
  const url = window.location.href.split("?")[0];
  navigator.clipboard.writeText(url);
  alert("Link copiado! Voc√™ pode enviar este link para seus amigos.");
};
</script>
</body>
</html>
